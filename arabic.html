<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø±ÙˆØ­: Ø§Ù„ØµØ¯Ø¹ ÙˆØ§Ù„Ù…Ø­Ø±Ùƒ â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</title>
  <link rel="stylesheet" href="./style.css">
  <style>
    :root{
      color-scheme: light dark;
      --bg: #0a0c10; --fg:#e8eaed; --muted:#9aa0a6; --accent:#8ab4f8; --card:#111418; --border:#1f2328;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#ffffff; --fg:#0b0f14; --muted:#5f6368; --accent:#155bd6; --card:#f8fafc; --border:#e2e8f0; }
    }
    [data-theme="light"]{ --bg:#ffffff; --fg:#0b0f14; --muted:#5f6368; --accent:#155bd6; --card:#f8fafc; --border:#e2e8f0; }
    [data-theme="dark"]{ --bg: #0a0c10; --fg:#e8eaed; --muted:#9aa0a6; --accent:#8ab4f8; --card:#111418; --border:#1f2328; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Naskh Arabic', 'Noto Sans Arabic', Arial, sans-serif; background:var(--bg); color:var(--fg); }
    .container { max-width: 900px; margin: 0 auto; padding: 1.5rem; }
    .article { line-height: 1.95; font-size: 1.08rem; }
    .muted { color: var(--muted); font-size: .9rem; }
    a.map { color: var(--accent); text-decoration: none; border-bottom: 1px dashed var(--accent); }
    h1,h2,h3,h4,h5,h6{ color:var(--fg); margin:1.2rem 0 .5rem; line-height:1.25; }
    h1{font-size:2rem}
    h2{font-size:1.6rem}
    h3{font-size:1.3rem}
    @media (max-width: 640px){
      h1{font-size:1.6rem}
      h2{font-size:1.35rem}
      h3{font-size:1.15rem}
    }
    p{ margin:.6rem 0; text-wrap: pretty; }
    ul{ margin:.6rem 1.25rem; }
    li{ margin:.25rem 0; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:1rem; margin-bottom:1rem; }
    .topbar a, .topbar button { color:var(--accent); text-decoration:none; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:1rem; }
    .btn{ background:#0A1128; color:#fff; padding:.4rem .6rem; border-radius:8px; border:none; cursor:pointer }
  </style>
</head>
<body>
  <main class="container">
    <div class="topbar">
      <div>
        <h1 style="margin:0 0 .25rem 0">Ø¬ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ø±ÙˆØ­: Ø§Ù„ØµØ¯Ø¹ ÙˆØ§Ù„Ù…Ø­Ø±Ùƒ</h1>
        <div class="muted">ØªØ£Ù„ÙŠÙ: Ø¯. Ù…Ø­Ù…Ø¯ Ø§Ù„ÙØ§Ø¶Ù„</div>
        <div class="muted">Ø¹Ø±Ø¶ Ù…Ø¨Ø§Ø´Ø± Ù…Ù† story-arabic.md</div>
      </div>
      <div style="display:flex; gap:.5rem; align-items:center;">
        <button id="theme-toggle" class="btn" type="button">ğŸŒ— ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</button>
        <button id="lang-toggle" class="btn" type="button">EN â†” AR</button>
      </div>
    </div>
    <article id="content" class="article card" aria-live="polite">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Øµ...</article>
  </main>
  <script>
    function renderInlineFormatting(html){
      // bold **...** and emphasis *...* (very conservative)
      html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1<\/strong>');
      html = html.replace(/(^|\s)\*(.+?)\*(?=\s|$)/g, '$1<em>$2<\/em>');
      return html;
    }
    function linesToNodes(text){
      const lines = text.split(/\n/);
      const frag = document.createDocumentFragment();
      let listMode = false;
      let ul;
      for (const raw of lines){
        const line = raw; // keep RTL punctuation as is
        if (/^\s*$/.test(line)) { // blank line
          if (listMode){ listMode=false; frag.appendChild(ul); ul=null; }
          continue;
        }
        const hMatch = line.match(/^\s*(#{1,6})\s+(.+)/);
        if (hMatch){
          if (listMode){ listMode=false; frag.appendChild(ul); ul=null; }
          const level = Math.min(hMatch[1].length,6);
          const h = document.createElement('h'+level);
          h.textContent = hMatch[2];
          frag.appendChild(h);
          continue;
        }
        const liMatch = line.match(/^\s*[-â€¢]\s+(.+)/);
        if (liMatch){
          if (!listMode){ listMode=true; ul=document.createElement('ul'); }
          const li=document.createElement('li');
          li.innerHTML = renderInlineFormatting(liMatch[1]);
          ul.appendChild(li);
          continue;
        }
        const p = document.createElement('p');
        p.innerHTML = renderInlineFormatting(line);
        frag.appendChild(p);
      }
      if (listMode && ul){ frag.appendChild(ul); }
      return frag;
    }
    async function loadArabicStory() {
      try {
        const res = await fetch('./story-arabic.md');
        const text = await res.text();
        // Minimal cleanup: remove leading BOMs and ensure RTL preserved
        let html = text
          // Link the Tabuk execution coordinates (28Â°N 36Â°E) to the Municipality Mosque in Tabuk
          .replace(/\(28Â°N\s*36Â°E\)/g,
            '(<a class="map" target="_blank" rel="noopener" href="https://www.google.com/maps/search/?api=1&query=Tabuk+Municipality+Mosque">28Â°N 36Â°E</a>)')
          // Link the Grandfather Maki home in Khartoum when mentioned inline with the marker
          .replace(/\(Ù…Ù†Ø²Ù„\s+Ø§Ù„Ø¬Ø¯\s+Ù…ÙƒÙŠ\)/g,
            '(<a class="map" target="_blank" rel="noopener" href="https://www.google.com/maps/search/?api=1&query=Khartoum+Sudan">Ù…Ù†Ø²Ù„ Ø§Ù„Ø¬Ø¯ Ù…ÙƒÙŠ</a>)');
        document.getElementById('content').textContent = '';
        // Insert as HTML with simple markdown-ish headers rendering for lines starting with #
        const host = document.getElementById('content');
        host.innerHTML = '';
        const frag = linesToNodes(html);
        host.appendChild(frag);
        // Post-process: convert known markers to links across all elements
        host.querySelectorAll('p, li').forEach(el => {
          el.innerHTML = el.innerHTML
            .replace(/\(28Â°N\s*36Â°E\)/g,
              '(<a class="map" target="_blank" rel="noopener" href="https://www.google.com/maps/search/?api=1&query=Tabuk+Municipality+Mosque">28Â°N 36Â°E</a>)')
            .replace(/\(Ù…Ù†Ø²Ù„\s+Ø§Ù„Ø¬Ø¯\s+Ù…ÙƒÙŠ\)/g,
              '(<a class="map" target="_blank" rel="noopener" href="https://www.google.com/maps/search/?api=1&query=Khartoum+Sudan">Ù…Ù†Ø²Ù„ Ø§Ù„Ø¬Ø¯ Ù…ÙƒÙŠ</a>)');
        });
      } catch (e) {
        document.getElementById('content').textContent = 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Øµ.';
        console.error(e);
      }
    }
    loadArabicStory();
    document.addEventListener('DOMContentLoaded', function(){
      const btn = document.getElementById('lang-toggle');
      const themeBtn = document.getElementById('theme-toggle');
      // Theme initialize
      try{
        const saved = localStorage.getItem('theme');
        if (saved === 'light' || saved === 'dark') document.documentElement.setAttribute('data-theme', saved);
      }catch(e){}
      if(themeBtn){
        themeBtn.addEventListener('click', function(){
          const cur = document.documentElement.getAttribute('data-theme');
          const next = cur === 'light' ? 'dark' : 'light';
          document.documentElement.setAttribute('data-theme', next);
          try{ localStorage.setItem('theme', next);}catch(e){}
        });
      }
      if(btn){
        btn.addEventListener('click', function(){
          try{ localStorage.setItem('langPref','en'); }catch(e){}
          window.location.href = 'english.html';
        });
      }
    });
  </script>
</body>
</html>
